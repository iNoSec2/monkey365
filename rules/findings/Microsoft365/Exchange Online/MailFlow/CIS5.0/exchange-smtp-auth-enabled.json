{
  "args": [],
  "provider": "Microsoft365",
  "serviceType": "Exchange Online",
  "serviceName": "Microsoft 365",
  "displayName": "Ensure SMTP AUTH is disabled",
  "description": "This setting enables or disables authenticated client SMTP submission (SMTP AUTH) at an organization level in Exchange Online.\n\nThe recommended state is Turn off SMTP AUTH protocol for your organization (checked).",
  "rationale": "SMTP AUTH is a legacy protocol. Disabling it at the organization level supports the principle of least functionality and serves to further back additional controls that block legacy protocols, such as in Conditional Access. Virtually all modern email clients that connect to Exchange Online mailboxes in Microsoft 365 can do so without using SMTP AUTH.",
  "impact": "This enforces the default behavior, so no impact is expected unless the organization is using it globally. A per-mailbox setting exists that overrides the tenant-wide setting, allowing an individual mailbox SMTP AUTH capability for special cases.",
  "remediation": {
    "text": "To remediate using the UI:\n1. Navigate to Exchange admin center https://admin.exchange.microsoft.com.\n2. Select Settings > Mail flow.\n3. Uncheck Turn off SMTP AUTH protocol for your organization.\n\nTo remediate using PowerShell:\n1. Connect to Exchange Online using Connect-ExchangeOnline.\n2. Run the following PowerShell command:\n   Set-TransportConfig -SmtpClientAuthenticationDisabled $true",
    "code": {
      "powerShell": null,
      "iac": null,
      "terraform": null,
      "other": null
    }
  },
  "recommendation": null,
  "references": [
    "https://learn.microsoft.com/en-us/exchange/clients-and-mobile-in-exchangeonline/authenticated-client-smtp-submission"
  ],
  "compliance": [
    {
      "name": "CIS Microsoft 365 Foundations",
      "version": "5.0.0",
      "reference": "2.1.2" 
    }
  ],
  "level": "medium",
  "tags": [
    "CIS Microsoft 365 Foundations 5.0.0 2.1.2",
    "Exchange Online",
    "MailFlow"
  ],
  "rule": {
    "path": "Get-MonkeyEXOAuthenticationPolicy",
    "subPath": null,
    "selectCondition": "[?allowBasicAuthSmtp == 'True']",
    "query": [],
    "shouldExist": null,
    "returnObject": null,
    "removeIfNotExists": null
  },
  "output": {
    "html": {
      "data": {
        "properties": {
          "name": "Policy Name",
          "allowBasicAuthSmtp": "SMTP Basic Auth Allowed"
        },
        "expandObject": null
      },
      "table": "Normal",
      "decorate": [
        {
          "ItemName": "SMTP Basic Auth Allowed",
          "ItemValue": "True",
          "className": "badge bg-danger larger-badge"
        }
      ],
      "emphasis": [],
      "actions": {
        "objectData": {
          "properties": ["*"],
          "expandObject": null,
          "limit": null
        },
        "showGoToButton": "True",
        "showModalButton": "True",
        "directLink": null
      }
    },
    "text": {
      "data": {
        "properties": {},
        "expandObject": null
      },
      "status": {
        "keyName": [],
        "message": "SMTP AUTH (Basic Authentication) is enabled in some Exchange Online Authentication Policies.",
        "defaultMessage": null
      },
      "properties": {
        "resourceName": "name",
        "resourceId": "identity",
        "resourceType": "Microsoft.Exchange.Management.SystemConfigurationTasks.AuthenticationPolicy"
      },
      "onlyStatus": false
    }
  },
  "idSuffix": "exchange-smtp-auth-enabled",
  "notes": ["This control is similar to 6.5.4 but checks Authentication Policies instead of the global TransportConfig. The CIS benchmark v5.0.0 section 2.1.2 refers to disabling SMTP AUTH via Authentication Policies, while 6.5.4 refers to the global setting."],
  "categories": []
}