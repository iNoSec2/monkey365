{
  "args": [],
  "provider": "Microsoft365",
  "serviceType": "Microsoft Purview",
  "serviceName": "Microsoft 365",
  "displayName": "Ensure Microsoft 365 audit log search is Enabled",
  "description": "When audit log search is enabled in the Microsoft Purview compliance portal, user and admin activity within the organization is recorded in the audit log and retained for 180 days by default. However, some organizations may prefer to use a third-party security information and event management (SIEM) application to access their auditing data. In this scenario, a global admin can choose to turn off audit log search in Microsoft 365.",
  "rationale": "Enabling audit log search in the Microsoft Purview compliance portal can help organizations improve their security posture, meet regulatory compliance requirements, respond to security incidents, and gain valuable operational insights.",
  "impact": "None - this is the default behavior as of 2019.",
  "remediation": {
    "text": "To remediate using the UI:\n1. Navigate to Microsoft Purview https://purview.microsoft.com/\n2. Select Solutions and then Audit to open the audit search.\n3. Click blue bar Start recording user and admin activity.\n4. Click Yes on the dialog box to confirm.\n\nTo remediate using PowerShell:\n1. Connect to Exchange Online using Connect-ExchangeOnline.\n2. Run the following PowerShell command:\n   Set-AdminAuditLogConfig -UnifiedAuditLogIngestionEnabled $true",
    "code": {
      "powerShell": null,
      "iac": null,
      "terraform": null,
      "other": null
    }
  },
  "recommendation": null,
  "references": [
    "https://learn.microsoft.com/en-us/purview/audit-log-enable-disable?view=o365worldwide&tabs=microsoft-purview-portal",
    "https://learn.microsoft.com/en-us/powershell/module/exchange/setadminauditlogconfig?view=exchange-ps"
  ],
  "compliance": [
    {
      "name": "CIS Microsoft 365 Foundations",
      "version": "5.0.0",
      "reference": "7.1.1" 
    }
  ],
  "level": "medium",
  "tags": [
    "CIS Microsoft 365 Foundations 5.0.0 7.1.1",
    "Microsoft Purview",
    "Audit"
  ],
  "rule": {
    "path": "Get-MonkeyEXOAdminAuditLogConfig",
    "subPath": null,
    "selectCondition": "[?unifiedAuditLogIngestionEnabled == 'False']",
    "query": [],
    "shouldExist": null,
    "returnObject": null,
    "removeIfNotExists": null
  },
  "output": {
    "html": {
      "data": {
        "properties": {
          "unifiedAuditLogIngestionEnabled": "Unified Audit Log Ingestion Enabled"
        },
        "expandObject": null
      },
      "table": "Normal",
      "decorate": [
        {
          "ItemName": "Unified Audit Log Ingestion Enabled",
          "ItemValue": "False",
          "className": "badge bg-danger larger-badge"
        }
      ],
      "emphasis": [],
      "actions": {
        "objectData": {
          "properties": ["*"],
          "expandObject": null,
          "limit": null
        },
        "showGoToButton": "False",
        "showModalButton": "True",
        "directLink": null
      }
    },
    "text": {
      "data": {
        "properties": {},
        "expandObject": null
      },
      "status": {
        "keyName": [],
        "message": "Microsoft 365 audit log search (Unified Audit Log Ingestion) is disabled.",
        "defaultMessage": null
      },
      "properties": {
        "resourceName": "AdminAuditLogConfig",
        "resourceId": "OrganizationConfig",
        "resourceType": "Microsoft.Exchange.Data.Directory.Management.AdminAuditLogConfig"
      },
      "onlyStatus": true
    }
  },
  "idSuffix": "purview-audit-log-search-disabled",
  "notes": ["This control is similar to 3.1.1."],
  "categories": []
}