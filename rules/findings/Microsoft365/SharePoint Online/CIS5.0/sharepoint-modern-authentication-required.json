{
  "args": [],
  "provider": "Microsoft365",
  "serviceType": "SharePoint Online",
  "serviceName": "Microsoft 365",
  "displayName": "Ensure modern authentication for SharePoint applications is required",
  "description": "Modern authentication in Microsoft 365 enables authentication features like multifactor authentication (MFA) using smart cards, certificate-based authentication (CBA), and third-party SAML identity providers.",
  "rationale": "Strong authentication controls, such as the use of multifactor authentication, may be circumvented if basic authentication is used by SharePoint applications. Requiring modern authentication for SharePoint applications ensures strong authentication mechanisms are used when establishing sessions between these applications, SharePoint, and connecting users.",
  "impact": "Implementation of modern authentication for SharePoint will require users to authenticate to SharePoint using modern authentication. This may cause a minor impact to typical user behavior.\n\nThis may also prevent third-party apps from accessing SharePoint Online resources. Also, this will also block apps using the SharePointOnlineCredentials class to access SharePoint Online resources.",
  "remediation": {
    "text": "To remediate using the UI:\n1. Navigate to SharePoint admin center https://admin.microsoft.com/sharepoint.\n2. Click to expand Policies select Access control.\n3. Select Apps that don't use modern authentication.\n4. Select the radio button for Block access.\n5. Click Save.\n\nTo remediate using PowerShell:\n1. Connect to SharePoint Online using Connect-SPOService -Url https://tenant-admin.sharepoint.com replacing tenant with your value.\n2. Run the following SharePoint Online PowerShell command:\n   Set-SPOTenant -LegacyAuthProtocolsEnabled $false",
    "code": {
      "powerShell": null,
      "iac": null,
      "terraform": null,
      "other": null
    }
  },
  "recommendation": null,
  "references": [
    "https://learn.microsoft.com/en-us/powershell/module/sharepoint-online/setspotenant?view=sharepoint-ps"
  ],
  "compliance": [
    {
      "name": "CIS Microsoft 365 Foundations",
      "version": "5.0.0",
      "reference": "2.1.3" 
    }
  ],
  "level": "medium",
  "tags": [
    "CIS Microsoft 365 Foundations 5.0.0 2.1.3",
    "SharePoint Online"
  ],
  "rule": {
    "path": "Get-MonkeySharePointOnlineTenantInfo",
    "subPath": null,
    "selectCondition": "[?legacyAuthProtocolsEnabled == 'True']",
    "query": [],
    "shouldExist": null,
    "returnObject": null,
    "removeIfNotExists": null
  },
  "output": {
    "html": {
      "data": {
        "properties": {
          "legacyAuthProtocolsEnabled": "Legacy Authentication Protocols Enabled"
        },
        "expandObject": null
      },
      "table": "Normal",
      "decorate": [
        {
          "ItemName": "Legacy Authentication Protocols Enabled",
          "ItemValue": "True",
          "className": "badge bg-danger larger-badge"
        }
      ],
      "emphasis": [],
      "actions": {
        "objectData": {
          "properties": ["*"],
          "expandObject": null,
          "limit": null
        },
        "showGoToButton": "False", 
        "showModalButton": "True",
        "directLink": null
      }
    },
    "text": {
      "data": {
        "properties": {},
        "expandObject": null
      },
      "status": {
        "keyName": [],
        "message": "Modern authentication for SharePoint applications is not required (legacy authentication is enabled).",
        "defaultMessage": null
      },
      "properties": {
        "resourceName": "SharePointTenantSettings",
        "resourceId": "TenantSettings",
        "resourceType": "Microsoft.Online.SharePoint.TenantAdministration.Tenant"
      },
      "onlyStatus": true 
    }
  },
  "idSuffix": "sharepoint-modern-authentication-required",
  "notes": ["This control is similar to 7.2.1 but refers to a different CIS benchmark section. The underlying check is the same."],
  "categories": []
}