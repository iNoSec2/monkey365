{
  "args": [],
  "provider": "Microsoft365",
  "serviceType": "EntraID",
  "serviceName": "Microsoft 365",
  "displayName": "Ensure the option to remain signed in is hidden",
  "description": "The option for the user to Stay signed in, or the Keep me signed in option, will prompt a user after a successful login. When the user selects this option, a persistent refresh token is created. The refresh token lasts for 90 days by default and does not prompt for sign-in or multifactor.",
  "rationale": "Allowing users to select this option presents risk, especially if the user signs into their account on a publicly accessible computer/web browser. In this case it would be trivial for an unauthorized person to gain access to any associated cloud data from that account.",
  "impact": "Once this setting is hidden users will no longer be prompted upon sign-in with the message Stay signed in?. This may mean users will be forced to sign in more frequently. Important: some features of SharePoint Online and Office 2010 have a dependency on users remaining signed in. If you hide this option, users may get additional and unexpected sign in prompts.",
  "remediation": {
    "text": "To remediate using the UI:\n1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/.\n2. Click to expand Identity> Users > User settings.\n3. Set Show keep user signed in to No.\n4. Click Save.",
    "code": {
      "powerShell": null,
      "iac": null,
      "terraform": null,
      "other": null
    }
  },
  "recommendation": null,
  "references": [
    "https://learn.microsoft.com/en-us/entra/identity/authentication/concepts-azuremulti-factor-authentication-prompts-session-lifetime",
    "https://learn.microsoft.com/en-us/entra/fundamentals/how-to-manage-staysigned-in-prompt"
  ],
  "compliance": [
    {
      "name": "CIS Microsoft 365 Foundations",
      "version": "5.0.0",
      "reference": "5.1.1" 
    }
  ],
  "level": "high", 
  "tags": [
    "CIS Microsoft 365 Foundations 5.0.0 5.1.1",
    "EntraID",
    "Policy"
  ],
  "rule": {
    "path": "Get-MonkeyADPolicy",
    "subPath": null,
    "selectCondition": "[?value.allowStaySignedIn == 'False']", 
    "query": [],
    "shouldExist": null, 
    "returnObject": null,
    "removeIfNotExists": null
  },
  "output": {
    "html": {
      "data": {
        "properties": {
          "allowStaySignedIn": "Allow Stay Signed In"
        },
        "expandObject": "value"
      },
      "table": "Normal",
      "decorate": [
        {
          "ItemName": "Allow Stay Signed In",
          "ItemValue": "False", 
          "className": "badge bg-danger larger-badge"
        }
      ],
      "emphasis": [],
      "actions": {
        "objectData": {
          "properties": ["*"],
          "expandObject": null,
          "limit": null
        },
        "showGoToButton": "False",
        "showModalButton": "True",
        "directLink": null
      }
    },
    "text": {
      "data": {
        "properties": {},
        "expandObject": null
      },
      "status": {
        "keyName": [],
        "message": "The 'Stay signed in' option is not hidden (allowStaySignedIn is False, meaning the prompt is shown).",
        "defaultMessage": null
      },
      "properties": {
        "resourceName": "DirectorySettings",
        "resourceId": "TenantDefault", 
        "resourceType": "Microsoft.Graph.Policy" 
      },
      "onlyStatus": true
    }
  },
  "idSuffix": "eid-stay-signed-policy-disabled",
  "notes": ["This control is similar to 5.1.2.5. The CIS benchmark 5.1.1 (renumbered from 5.1.2.5 in v4 to v5) is about hiding the 'stay signed in' prompt. The `allowStaySignedIn` property in `Get-MonkeyADPolicy` (likely `Get-MgPolicyAuthorizationPolicy` or similar) being `False` means the prompt *is* shown. The rule `[?value.allowStaySignedIn == 'False']` looks for this non-compliant state. The remediation is to set it to 'No' in UI, which means `allowStaySignedIn` should be `True` to hide the prompt. The logic seems inverted in the rule's selectCondition if the goal is to find non-compliance with 'hiding the prompt'. If `allowStaySignedIn` being `False` means the prompt is *shown*, then the rule correctly identifies non-compliance with 'hiding the prompt'. The remediation in v5.txt for 5.1.2.5 is to set 'Show keep user signed in' to 'No'. This corresponds to `allowStaySignedIn` being `True` in the policy. So, the rule `[?value.allowStaySignedIn == 'False']` correctly finds when the prompt is *not* hidden."],
  "categories": []
}