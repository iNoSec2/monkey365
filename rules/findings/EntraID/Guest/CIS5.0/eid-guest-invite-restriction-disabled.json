{
  "args": [],
  "provider": "Microsoft365",
  "serviceType": "EntraID",
  "serviceName": "Microsoft 365",
  "displayName": "Ensure guest user invitations are limited to the Guest Inviter role",
  "description": "By default, all users in the organization, including B2B collaboration guest users, can invite external users to B2B collaboration. The ability to send invitations can be limited by turning it on or off for everyone, or by restricting invitations to certain roles.\n\nThe recommended state for guest invite restrictions is Only users assigned to specific admin roles can invite guest users.",
  "rationale": "Restricting who can invite guests limits the exposure the organization might face from unauthorized accounts.",
  "impact": "This introduces an obstacle to collaboration by restricting who can invite guest users to the organization. Designated Guest Inviters must be assigned, and an approval process established and clearly communicated to all users.",
  "remediation": {
    "text": "To remediate using the UI:\n1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/.\n2. Click to expand Identity > External Identities select External collaboration settings.\n3. Under Guest invite settings set Guest invite restrictions to Only users assigned to specific admin roles can invite guest users.\n\nTo remediate using PowerShell:\n1. Connect to Microsoft Graph using Connect-MgGraph -Scopes \"Policy.ReadWrite.Authorization\"\n2. Run the following command:\n   Update-MgPolicyAuthorizationPolicy -AllowInvitesFrom 'adminsAndGuestInviters'\n\nNote: The more restrictive position of the value will also pass audit, it is however not required.",
    "code": {
      "powerShell": null,
      "iac": null,
      "terraform": null,
      "other": null
    }
  },
  "recommendation": null,
  "references": [
    "https://learn.microsoft.com/en-us/entra/external-id/external-collaboration-settingsconfigure",
    "https://learn.microsoft.com/en-us/entra/identity/role-based-accesscontrol/permissions-reference#guest-inviter"
  ],
  "compliance": [
    {
      "name": "CIS Microsoft 365 Foundations",
      "version": "5.0.0",
      "reference": "4.1.1" 
    }
  ],
  "level": "high", 
  "tags": [
    "CIS Microsoft 365 Foundations 5.0.0 4.1.1",
    "EntraID",
    "Guest"
  ],
  "rule": {
    "path": "Get-MonkeyAADExternalCollaboration",
    "subPath": null,
    "selectCondition": "[?value.allowGuestsToInvite -ne 'False']",
    "query": [],
    "shouldExist": null,
    "returnObject": null,
    "removeIfNotExists": null
  },
  "output": {
    "html": {
      "data": {
        "properties": {
          "allowGuestsToInvite": "Guests Can Invite"
        },
        "expandObject": "value"
      },
      "table": "Normal",
      "decorate": [
        {
          "ItemName": "Guests Can Invite",
          "ItemValue": "True",
          "className": "badge bg-danger larger-badge"
        }
      ],
      "emphasis": [],
      "actions": {
        "objectData": {
          "properties": ["*"],
          "expandObject": null,
          "limit": null
        },
        "showGoToButton": "False", 
        "showModalButton": "True",
        "directLink": null
      }
    },
    "text": {
      "data": {
        "properties": {},
        "expandObject": null
      },
      "status": {
        "keyName": [],
        "message": "Guest user invitation restrictions are not configured to limit invites to specific admin roles (e.g., Guest Inviter).",
        "defaultMessage": null
      },
      "properties": {
        "resourceName": "ExternalCollaborationSettings",
        "resourceId": "AuthorizationPolicy",
        "resourceType": "Microsoft.Graph.AuthorizationPolicy" 
      },
      "onlyStatus": true 
    }
  },
  "idSuffix": "eid-guest-invite-restriction-disabled",
  "notes": ["This control is similar to 5.1.6.3. The CIS benchmark 4.1.1 specifically mentions 'allowGuestsToInvite' which is a setting within the broader external collaboration settings. L2 for 5.1.6.3 is appropriate."],
  "categories": []
}